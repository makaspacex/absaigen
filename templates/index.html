{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>广播电视和网络视听智能媒体内容生成系统</title>
  <link rel="stylesheet" href="{% static 'app.css' %}">
</head>
<body>
{% if not user.is_authenticated %}
<!-- 登录页面 -->
<div id="loginPage" class="login-page">
  <div class="login-title">
    <div>
      广播电视和网络视听智能媒体内容生成系统
      <div class="login-sub">Broadcasting & Online AV Intelligent Media Generation System</div>
    </div>
    <div class="header-pill">
      <div class="header-pill-dot"></div>
      <span>内网已连接</span>
    </div>
  </div>
  <div class="login-main">
    <div class="login-box neon-card">
      <form class="login-inner" method="post" action="">
        {% csrf_token %}
        {% if login_error %}
        <div class="login-error">{{ login_error }}</div>
        {% endif %}
        <div class="login-field">
          <label class="login-label">用户名：</label>
          <input id="username" name="username" class="login-input" type="text" value="{{ login_username|default:'' }}" autocomplete="username" required />
        </div>
        <div class="login-field">
          <label class="login-label">密&nbsp;&nbsp;&nbsp;码：</label>
          <input id="password" name="password" class="login-input" type="password" autocomplete="current-password" required />
        </div>
        <button class="btn-login" type="submit">登录</button>
      </form>
    </div>
  </div>
</div>
{% else %}
<!-- 主系统页面 -->
<div id="appPage">
  <div class="app-header">
    <div class="app-title-block">
      <div class="app-title-main">
        广播电视和网络视听智能媒体内容生成系统
      </div>
    </div>
    <div class="app-header-right">
      <div class="header-pill">
        <div class="header-pill-dot"></div>
        <span>生成引擎在线</span>
      </div>
      <div class="user-pill">
        <div class="user-avatar"></div>
        <span>{{ request.user.username }}</span>
      </div>
      <form class="logout-form" method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="btn-logout">退出</button>
      </form>
    </div>
  </div>

  <div class="app-container">
    <!-- 左侧导航 -->
    <div class="sidebar">
      <div class="sidebar-header">WORKSPACE</div>
      <div class="nav-item active" data-mode="image" onclick="switchMode('image', this)">
        <span class="nav-item-icon">🖼</span>
        <span>图像生成</span>
      </div>
      <div class="nav-item" data-mode="audio" onclick="switchMode('audio', this)">
        <span class="nav-item-icon">🎧</span>
        <span>音频生成</span>
      </div>
      <div class="nav-item" data-mode="video" onclick="switchMode('video', this)">
        <span class="nav-item-icon">🎬</span>
        <span>视频生成</span>
      </div>
      <div class="nav-item nav-item-library" onclick="switchToLibrary(this)">
        <span class="nav-item-icon">📚</span>
        <span>生成内容库</span>
      </div>
    </div>

    <!-- 右侧主体 -->
    <div class="main">
      <!-- 生成界面 -->
      <div id="generationMain">
        <div class="main-top">
          <!-- 预览区域 -->
          <div class="preview-panel neon-card">
            <div class="preview-panel-header">
              <div class="preview-title">生成结果预览</div>
              <div class="panel-tag" id="previewModeTag">模式：图像</div>
            </div>
            <div class="preview-panel-inner">
              <div class="preview-grid">
                <div id="previewPlaceholder" class="preview-placeholder">
                  <div class="preview-placeholder-title">图片生成预览区域</div>
                  <div>点击右侧「生成」后，将在此显示 ./1.jpeg / 2.mp4 / 3.mp3</div>
                </div>

                <div id="loadingBox" class="loading-box">
                  <div class="spinner"></div>
                  <div id="loadingText">正在生成，请稍候…</div>
                </div>

                <img id="imageResult" alt="图像结果" />

                <div id="audioPreview">
                  <div class="preview-placeholder-title">音频生成结果</div>
                  <audio id="audioPlayer" controls></audio>
                </div>

                <div id="videoPreview">
                  <div class="preview-placeholder-title">视频生成结果</div>
                  <video id="videoPlayer" controls></video>
                </div>
              </div>
            </div>
          </div>

          <!-- 参数配置 + 生成 -->
          <div class="control-panel neon-card">
            <div class="control-fields">
              <div class="field">
                <span id="styleLabel" class="field-label">主题风格：</span>
                <div class="radio-group" id="styleOptions">
                  <label><input type="radio" name="style" value="动画" checked> 动画</label>
                  <label><input type="radio" name="style" value="写实"> 写实</label>
                  <label><input type="radio" name="style" value="演播室"> 演播室</label>
                  <label><input type="radio" name="style" value="其他"> 其他</label>
                </div>

                <div class="radio-group hidden" id="voiceOptions">
                  <label><input type="radio" name="voice" value="男声1" checked> 男声1</label>
                  <label><input type="radio" name="voice" value="男声2"> 男声2</label>
                  <label><input type="radio" name="voice" value="女生1"> 女声1</label>
                  <label><input type="radio" name="voice" value="女生2"> 女声2</label>
                </div>
              </div>

              <div class="field">
                <span class="field-label">模型：</span>
                <select id="modelSelect" class="dropdown">
                  <option value="广科院">广科院</option>
                  <option value="海螺">海螺</option>
                  <option value="即梦">即梦</option>
                  <option value="可灵">可灵</option>
                </select>
              </div>

              <div class="field">
                <span class="field-label">关键词 prompt：</span>
                <textarea id="promptInput" placeholder="请输入用于生成内容的关键词、场景描述等……"></textarea>
              </div>
            </div>

            <div class="generate-panel">
              <button id="generateBtn" class="btn-generate" onclick="handleGenerate()">生成</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 生成内容库页面 -->
      <div id="libraryMain" class="hidden">
        <div id="libraryPanel" class="library-panel neon-card">
          <div class="library-header">
            <div>
              <div class="library-title">
                <div class="library-title-dot"></div>
                <span>生成内容库</span>
              </div>
              <div id="libraryStats" class="library-stats">暂无记录</div>
            </div>
            <div class="library-filters">
              <button class="filter-pill active" data-filter="all" onclick="setLibraryFilter('all', this)">全部</button>
              <button class="filter-pill" data-filter="image" onclick="setLibraryFilter('image', this)">图像</button>
              <button class="filter-pill" data-filter="audio" onclick="setLibraryFilter('audio', this)">音频</button>
              <button class="filter-pill" data-filter="video" onclick="setLibraryFilter('video', this)">视频</button>
            </div>
          </div>
          <div id="libraryList" class="library-list">
            <div class="library-empty">暂无生成记录，生成后的图像、音频、视频将自动存入此处。</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endif %}

<script src="{% static 'app.js' %}"></script>

</body>
</html>
